generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String       @id @default(cuid())
  email         String       @unique
  password      String
  firstName     String
  lastName      String
  role          UserRole
  schoolId      String?
  school        School?      @relation(fields: [schoolId], references: [id])
  enrollments   Enrollment[]
  teachingClasses   Class[]         @relation("TeachingClasses")
  enrolledClasses   ClassStudent[]  @relation("StudentClasses")
  totalPoints   Int          @default(0)
  currentStreak Int          @default(0)
  longestStreak Int          @default(0)
  
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
}

model School {
  id            String    @id @default(cuid())
  name          String
  domain        String?   @unique
  city          String?
  state         String?
  primaryColor  String    @default("#0a1f44")
  logo          String?
  
  users         User[]
  courses       Course[]
  classes       Class[]    // Add this line
  createdAt     DateTime  @default(now())
}

model Course {
  id            String       @id @default(cuid())
  title         String
  description   String
  category      String
  duration      Int
  schools       School[]
  enrollments   Enrollment[]
  assignments   Assignment[]
  createdAt     DateTime     @default(now())
}

model Enrollment {
  id            String    @id @default(cuid())
  userId        String
  courseId      String
  user          User      @relation(fields: [userId], references: [id])
  course        Course    @relation(fields: [courseId], references: [id])
  progress      Float     @default(0)
  status        String    @default("NOT_STARTED")
  startedAt     DateTime  @default(now())
  completedAt   DateTime?
  
  @@unique([userId, courseId])
}

enum UserRole {
  STUDENT
  TEACHER
  SCHOOL_ADMIN
  SUPER_ADMIN
}
model Class {
  id            String          @id @default(cuid())
  name          String
  code          String          @unique
  description   String?
  
  teacherId     String
  teacher       User            @relation("TeachingClasses", fields: [teacherId], references: [id])
  schoolId      String
  school        School          @relation(fields: [schoolId], references: [id])
  
  students      ClassStudent[]
  assignments   Assignment[]
  
  isActive      Boolean         @default(true)
  startDate     DateTime?
  endDate       DateTime?
  
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model ClassStudent {
  id            String    @id @default(cuid())
  classId       String
  class         Class     @relation(fields: [classId], references: [id])
  studentId     String
  student       User      @relation("StudentClasses", fields: [studentId], references: [id])
  
  joinedAt      DateTime  @default(now())
  
  @@unique([classId, studentId])
}

model Assignment {
  id            String    @id @default(cuid())
  classId       String
  class         Class     @relation(fields: [classId], references: [id])
  courseId      String
  course        Course    @relation(fields: [courseId], references: [id])
  
  title         String
  dueDate       DateTime?
  points        Int       @default(100)
  
  createdAt     DateTime  @default(now())
}